<div class="elite-dashboard">
  <!-- Header -->
  <div class="elite-header">
    <div class="header-content">
      <h1>AI Command Center</h1>
      <p>Elite Conversion System - AI-Human Communication Dashboard</p>
    </div>
    <button class="refresh-btn" (click)="loadDashboard()" [disabled]="loading">
      {{ loading ? 'Loading...' : 'Refresh' }}
    </button>
  </div>

  <!-- Navigation Cards -->
  <div class="nav-cards">
    <a routerLink="/elite/insights" class="nav-card">
      <div class="nav-icon purple">
        <mat-icon>auto_awesome</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">AI Insights</div>
        <div class="nav-subtitle">Patterns & Recommendations</div>
      </div>
    </a>
    <a routerLink="/elite/ab-tests" class="nav-card">
      <div class="nav-icon green">
        <mat-icon>science</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">A/B Testing</div>
        <div class="nav-subtitle">Test Response Variations</div>
      </div>
    </a>
    <a routerLink="/elite/feedback" class="nav-card">
      <div class="nav-icon orange">
        <mat-icon>feedback</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">Feedback Analysis</div>
        <div class="nav-subtitle">Human Feedback Patterns</div>
      </div>
    </a>
    <a routerLink="/elite/tone-performance" class="nav-card">
      <div class="nav-icon blue">
        <mat-icon>record_voice_over</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">Tone Performance</div>
        <div class="nav-subtitle">Best Tones by Subreddit</div>
      </div>
    </a>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading Elite Dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <ng-container *ngIf="!loading && dashboardData">
    <!-- Key Metrics Row -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-label">Total Opportunities</div>
        <div class="metric-value default">{{ dashboardData.metrics.total_opportunities }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Posted</div>
        <div class="metric-value green">{{ dashboardData.metrics.posted_responses }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Tier 1/2 Rate</div>
        <div class="metric-value purple">{{ formatPercentage(dashboardData.metrics.tier_1_2_rate) }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Success Rate</div>
        <div class="metric-value blue">{{ formatPercentage(dashboardData.metrics.success_rate) }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Total Clicks</div>
        <div class="metric-value orange">{{ dashboardData.metrics.total_clicks }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Conversions</div>
        <div class="metric-value emerald">{{ dashboardData.metrics.total_conversions }}</div>
      </div>
    </div>

    <!-- Two Column Layout -->
    <div class="content-grid">
      <!-- Left Column: AI Insights -->
      <div class="content-column">
        <!-- Pending AI Insights -->
        <div class="glass-card">
          <div class="card-header">
            <h2>AI Insights</h2>
            <a routerLink="/elite/insights">View All</a>
          </div>
          <div class="card-body">
            <ng-container *ngIf="dashboardData.pending_insights.length > 0; else noInsights">
              <div class="insights-list">
                <div *ngFor="let insight of dashboardData.pending_insights"
                     class="insight-item"
                     [routerLink]="['/elite/insights', insight.id]">
                  <div class="insight-icon" [ngClass]="insight.type">
                    <mat-icon>{{ getInsightIcon(insight.type) }}</mat-icon>
                  </div>
                  <div class="insight-content">
                    <div class="insight-header">
                      <span class="insight-title">{{ insight.title }}</span>
                      <span class="priority-badge" [ngClass]="insight.priority">
                        {{ insight.priority }}
                      </span>
                    </div>
                    <p class="insight-summary">{{ insight.summary }}</p>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #noInsights>
              <div class="empty-insights">
                <mat-icon>check_circle</mat-icon>
                <p>No pending insights. The AI will notify you when it detects important patterns.</p>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Insight Stats -->
        <div *ngIf="insightStats" class="glass-card">
          <div class="insight-stats">
            <h3>Insight Summary</h3>
            <div class="stats-row">
              <div class="stat-item">
                <div class="stat-value default">{{ insightStats.new }}</div>
                <div class="stat-label">New</div>
              </div>
              <div class="stat-item">
                <div class="stat-value orange">{{ insightStats.high_priority }}</div>
                <div class="stat-label">High Priority</div>
              </div>
              <div class="stat-item">
                <div class="stat-value blue">{{ insightStats.pending_action }}</div>
                <div class="stat-label">Need Action</div>
              </div>
              <div class="stat-item">
                <div class="stat-value gray">{{ insightStats.total }}</div>
                <div class="stat-label">Total</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Intent Distribution & Performance -->
      <div class="content-column">
        <!-- Intent Tier Distribution -->
        <div class="glass-card">
          <div class="intent-section">
            <h2>Intent Distribution (30 days)</h2>
            <div class="intent-bars">
              <div *ngFor="let item of intentChartData" class="intent-bar">
                <div class="intent-label">{{ item.label }}</div>
                <div class="bar-container">
                  <div class="bar-fill"
                       [style.width.%]="getIntentPercentage(item.count)"
                       [style.backgroundColor]="item.color">
                  </div>
                </div>
                <div class="intent-count">{{ item.count }}</div>
              </div>
            </div>
            <p class="intent-note">
              Tier 1 & 2 opportunities have the highest conversion potential. Focus on increasing these.
            </p>
          </div>
        </div>

        <!-- Top Subreddits -->
        <div class="glass-card">
          <div class="card-header">
            <h2>Top Performing Subreddits</h2>
          </div>
          <div class="card-body">
            <ng-container *ngIf="dashboardData.top_subreddits.length > 0; else noSubreddits">
              <div class="subreddits-list">
                <div *ngFor="let sub of dashboardData.top_subreddits" class="subreddit-item">
                  <div class="sub-info">
                    <div class="sub-name">r/{{ sub.name }}</div>
                    <div class="sub-responses">{{ sub.total_responses }} responses</div>
                    <div class="sub-stats">
                      <span>Conv: {{ formatPercentage(sub.conversion_rate) }}</span>
                      <span>Approval: {{ formatPercentage(sub.approval_rate) }}</span>
                    </div>
                  </div>
                  <div class="sub-value">
                    <div class="value">{{ formatCurrency(sub.expected_value) }}</div>
                    <div class="label">Expected Value</div>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #noSubreddits>
              <div class="empty-subreddits">
                <p>No subreddit performance data yet.</p>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Conversion Patterns -->
        <div class="glass-card" *ngIf="patterns.length > 0">
          <div class="card-header">
            <h2>Learned Patterns</h2>
          </div>
          <div class="card-body">
            <div class="patterns-list">
              <div *ngFor="let pattern of patterns.slice(0, 5)" class="pattern-item">
                <div class="pattern-info">
                  <div class="pattern-name">{{ pattern.name }}</div>
                  <p class="pattern-desc">{{ pattern.description }}</p>
                  <div class="pattern-meta">
                    <span>{{ pattern.sample_size }} samples</span>
                    <span>{{ formatPercentage(pattern.confidence) }} confidence</span>
                  </div>
                </div>
                <div class="pattern-lift">
                  <div class="lift-value" [ngClass]="pattern.lift_vs_baseline >= 1.5 ? 'high' : 'normal'">
                    {{ pattern.lift_vs_baseline.toFixed(1) }}x
                  </div>
                  <div class="lift-label">lift</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Outcomes -->
    <div class="glass-card outcomes-card" *ngIf="dashboardData.recent_outcomes.length > 0">
      <div class="card-header">
        <h2>Recent Outcomes</h2>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Opportunity</th>
              <th>Result</th>
              <th>Clicks</th>
              <th>Sentiment</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let outcome of dashboardData.recent_outcomes">
              <td class="opportunity-cell">
                <a [routerLink]="['/opportunities', outcome.opportunity_id]" class="opportunity-link">
                  <span class="subreddit-name">r/{{ outcome.subreddit }}</span>
                  <span class="post-title">{{ outcome.post_title | slice:0:50 }}{{ (outcome.post_title?.length || 0) > 50 ? '...' : '' }}</span>
                </a>
              </td>
              <td>
                <span class="result-badge" [ngClass]="outcome.success_type || 'pending'">
                  {{ outcome.success_type || 'pending' }}
                </span>
              </td>
              <td class="clicks">{{ outcome.clicks }}</td>
              <td>
                <span class="sentiment" [ngClass]="outcome.reply_sentiment">
                  {{ outcome.reply_sentiment }}
                </span>
              </td>
              <td class="date">{{ outcome.created_at | date:'short' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </ng-container>
</div>
