<div class="elite-dashboard">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">AI Command Center</h1>
      <p class="text-gray-600">Elite Conversion System - AI-Human Communication Dashboard</p>
    </div>
    <button
      (click)="loadDashboard()"
      class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
      [disabled]="loading"
    >
      <span *ngIf="loading">Loading...</span>
      <span *ngIf="!loading">Refresh</span>
    </button>
  </div>

  <!-- Phase 5 Navigation -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <a routerLink="/elite/insights"
       class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition-shadow cursor-pointer flex items-center gap-3">
      <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
        <span class="material-icons text-purple-600">auto_awesome</span>
      </div>
      <div>
        <div class="font-medium text-gray-900">AI Insights</div>
        <div class="text-xs text-gray-500">Patterns & Recommendations</div>
      </div>
    </a>
    <a routerLink="/elite/ab-tests"
       class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition-shadow cursor-pointer flex items-center gap-3">
      <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
        <span class="material-icons text-green-600">science</span>
      </div>
      <div>
        <div class="font-medium text-gray-900">A/B Testing</div>
        <div class="text-xs text-gray-500">Test Response Variations</div>
      </div>
    </a>
    <a routerLink="/elite/feedback"
       class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition-shadow cursor-pointer flex items-center gap-3">
      <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
        <span class="material-icons text-orange-600">feedback</span>
      </div>
      <div>
        <div class="font-medium text-gray-900">Feedback Analysis</div>
        <div class="text-xs text-gray-500">Human Feedback Patterns</div>
      </div>
    </a>
    <a routerLink="/elite/tone-performance"
       class="bg-white rounded-lg shadow p-4 hover:shadow-lg transition-shadow cursor-pointer flex items-center gap-3">
      <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
        <span class="material-icons text-blue-600">record_voice_over</span>
      </div>
      <div>
        <div class="font-medium text-gray-900">Tone Performance</div>
        <div class="text-xs text-gray-500">Best Tones by Subreddit</div>
      </div>
    </a>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
    <p class="mt-4 text-gray-600">Loading Elite Dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <ng-container *ngIf="!loading && dashboardData">
    <!-- Key Metrics Row -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-4">
        <div class="text-sm text-gray-500">Total Opportunities</div>
        <div class="text-2xl font-bold text-gray-900">{{ dashboardData.metrics.total_opportunities }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="text-sm text-gray-500">Posted</div>
        <div class="text-2xl font-bold text-green-600">{{ dashboardData.metrics.posted_responses }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="text-sm text-gray-500">Tier 1/2 Rate</div>
        <div class="text-2xl font-bold text-indigo-600">{{ formatPercentage(dashboardData.metrics.tier_1_2_rate) }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="text-sm text-gray-500">Success Rate</div>
        <div class="text-2xl font-bold text-blue-600">{{ formatPercentage(dashboardData.metrics.success_rate) }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="text-sm text-gray-500">Total Clicks</div>
        <div class="text-2xl font-bold text-orange-600">{{ dashboardData.metrics.total_clicks }}</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4">
        <div class="text-sm text-gray-500">Conversions</div>
        <div class="text-2xl font-bold text-emerald-600">{{ dashboardData.metrics.total_conversions }}</div>
      </div>
    </div>

    <!-- Two Column Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Left Column: AI Insights -->
      <div class="space-y-6">
        <!-- Pending AI Insights -->
        <div class="bg-white rounded-lg shadow">
          <div class="p-4 border-b border-gray-200 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900">AI Insights</h2>
            <a routerLink="/elite/insights" class="text-indigo-600 hover:text-indigo-800 text-sm">
              View All
            </a>
          </div>
          <div class="divide-y divide-gray-100">
            <ng-container *ngIf="dashboardData.pending_insights.length > 0; else noInsights">
              <div
                *ngFor="let insight of dashboardData.pending_insights"
                class="p-4 hover:bg-gray-50 cursor-pointer"
                [routerLink]="['/elite/insights', insight.id]"
              >
                <div class="flex items-start gap-3">
                  <div
                    class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center"
                    [ngClass]="{
                      'bg-green-100 text-green-600': insight.type === 'pattern',
                      'bg-yellow-100 text-yellow-600': insight.type === 'recommendation',
                      'bg-blue-100 text-blue-600': insight.type === 'question',
                      'bg-red-100 text-red-600': insight.type === 'alert',
                      'bg-purple-100 text-purple-600': insight.type === 'performance',
                      'bg-indigo-100 text-indigo-600': insight.type === 'learning'
                    }"
                  >
                    <span class="material-icons text-lg">{{ getInsightIcon(insight.type) }}</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                      <span class="font-medium text-gray-900">{{ insight.title }}</span>
                      <span
                        class="px-2 py-0.5 text-xs rounded-full"
                        [ngClass]="{
                          'bg-gray-100 text-gray-600': insight.priority === 'low',
                          'bg-blue-100 text-blue-600': insight.priority === 'medium',
                          'bg-orange-100 text-orange-600': insight.priority === 'high',
                          'bg-red-100 text-red-600': insight.priority === 'critical'
                        }"
                      >
                        {{ insight.priority }}
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1 line-clamp-2">{{ insight.summary }}</p>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #noInsights>
              <div class="p-8 text-center text-gray-500">
                <span class="material-icons text-4xl mb-2">check_circle</span>
                <p>No pending insights. The AI will notify you when it detects important patterns.</p>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Insight Stats -->
        <div *ngIf="insightStats" class="bg-white rounded-lg shadow p-4">
          <h3 class="text-sm font-medium text-gray-700 mb-3">Insight Summary</h3>
          <div class="grid grid-cols-4 gap-4 text-center">
            <div>
              <div class="text-2xl font-bold text-gray-900">{{ insightStats.new }}</div>
              <div class="text-xs text-gray-500">New</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-orange-600">{{ insightStats.high_priority }}</div>
              <div class="text-xs text-gray-500">High Priority</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-blue-600">{{ insightStats.pending_action }}</div>
              <div class="text-xs text-gray-500">Need Action</div>
            </div>
            <div>
              <div class="text-2xl font-bold text-gray-600">{{ insightStats.total }}</div>
              <div class="text-xs text-gray-500">Total</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Intent Distribution & Performance -->
      <div class="space-y-6">
        <!-- Intent Tier Distribution -->
        <div class="bg-white rounded-lg shadow p-4">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">Intent Distribution (30 days)</h2>
          <div class="space-y-3">
            <div *ngFor="let item of intentChartData" class="flex items-center gap-3">
              <div class="w-32 text-sm text-gray-700">{{ item.label }}</div>
              <div class="flex-1 bg-gray-200 rounded-full h-4 overflow-hidden">
                <div
                  class="h-full rounded-full transition-all duration-500"
                  [style.width.%]="getIntentPercentage(item.count)"
                  [style.backgroundColor]="item.color"
                ></div>
              </div>
              <div class="w-12 text-sm text-gray-600 text-right">{{ item.count }}</div>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-4">
            Tier 1 & 2 opportunities have the highest conversion potential. Focus on increasing these.
          </p>
        </div>

        <!-- Top Subreddits -->
        <div class="bg-white rounded-lg shadow">
          <div class="p-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-900">Top Performing Subreddits</h2>
          </div>
          <div class="divide-y divide-gray-100">
            <ng-container *ngIf="dashboardData.top_subreddits.length > 0; else noSubreddits">
              <div *ngFor="let sub of dashboardData.top_subreddits" class="p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <span class="font-medium text-gray-900">r/{{ sub.name }}</span>
                    <div class="text-sm text-gray-500">{{ sub.total_responses }} responses</div>
                  </div>
                  <div class="text-right">
                    <div class="text-lg font-semibold text-green-600">{{ formatCurrency(sub.expected_value) }}</div>
                    <div class="text-xs text-gray-500">Expected Value</div>
                  </div>
                </div>
                <div class="mt-2 flex gap-4 text-xs text-gray-500">
                  <span>Conv: {{ formatPercentage(sub.conversion_rate) }}</span>
                  <span>Approval: {{ formatPercentage(sub.approval_rate) }}</span>
                </div>
              </div>
            </ng-container>
            <ng-template #noSubreddits>
              <div class="p-8 text-center text-gray-500">
                <p>No subreddit performance data yet.</p>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Conversion Patterns -->
        <div class="bg-white rounded-lg shadow" *ngIf="patterns.length > 0">
          <div class="p-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-900">Learned Patterns</h2>
          </div>
          <div class="divide-y divide-gray-100">
            <div *ngFor="let pattern of patterns.slice(0, 5)" class="p-4">
              <div class="flex items-center justify-between">
                <div>
                  <span class="font-medium text-gray-900">{{ pattern.name }}</span>
                  <p class="text-sm text-gray-500">{{ pattern.description }}</p>
                </div>
                <div class="text-right">
                  <div
                    class="text-lg font-semibold"
                    [ngClass]="pattern.lift_vs_baseline >= 1.5 ? 'text-green-600' : 'text-gray-600'"
                  >
                    {{ pattern.lift_vs_baseline.toFixed(1) }}x
                  </div>
                  <div class="text-xs text-gray-500">lift</div>
                </div>
              </div>
              <div class="mt-2 flex gap-4 text-xs text-gray-500">
                <span>{{ pattern.sample_size }} samples</span>
                <span>{{ formatPercentage(pattern.confidence) }} confidence</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Outcomes -->
    <div class="bg-white rounded-lg shadow mt-6" *ngIf="dashboardData.recent_outcomes.length > 0">
      <div class="p-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Recent Outcomes</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Opportunity</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Result</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Clicks</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Sentiment</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr *ngFor="let outcome of dashboardData.recent_outcomes" class="hover:bg-gray-50">
              <td class="px-4 py-3">
                <a
                  [routerLink]="['/opportunities', outcome.opportunity_id]"
                  class="text-indigo-600 hover:text-indigo-800"
                >
                  {{ outcome.opportunity_id.slice(0, 8) }}...
                </a>
              </td>
              <td class="px-4 py-3">
                <span
                  class="px-2 py-1 text-xs rounded-full"
                  [ngClass]="{
                    'bg-green-100 text-green-800': outcome.success_type === 'conversion',
                    'bg-blue-100 text-blue-800': outcome.success_type === 'signup',
                    'bg-yellow-100 text-yellow-800': outcome.success_type === 'click',
                    'bg-purple-100 text-purple-800': outcome.success_type === 'positive_engagement',
                    'bg-gray-100 text-gray-800': !outcome.success_type
                  }"
                >
                  {{ outcome.success_type || 'pending' }}
                </span>
              </td>
              <td class="px-4 py-3 text-gray-600">{{ outcome.clicks }}</td>
              <td class="px-4 py-3">
                <span
                  [ngClass]="{
                    'text-green-600': outcome.reply_sentiment === 'positive',
                    'text-yellow-600': outcome.reply_sentiment === 'neutral',
                    'text-red-600': outcome.reply_sentiment === 'negative',
                    'text-gray-400': outcome.reply_sentiment === 'none'
                  }"
                >
                  {{ outcome.reply_sentiment }}
                </span>
              </td>
              <td class="px-4 py-3 text-gray-500 text-sm">
                {{ outcome.created_at | date:'short' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </ng-container>
</div>
