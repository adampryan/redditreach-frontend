<div class="elite-dashboard">
  <!-- Header -->
  <div class="elite-header">
    <div class="header-left">
      <a routerLink="/dashboard" class="back-link">
        <mat-icon>arrow_back</mat-icon>
        <span>Back to Dashboard</span>
      </a>
      <div class="header-content">
        <h1>AI Command Center</h1>
        <p>Elite Conversion System - AI-Human Communication Dashboard</p>
      </div>
    </div>
    <button class="refresh-btn" (click)="loadDashboard()" [disabled]="loading">
      {{ loading ? 'Loading...' : 'Refresh' }}
    </button>
  </div>

  <!-- Navigation Cards -->
  <div class="nav-cards">
    <a routerLink="/elite/insights" class="nav-card">
      <div class="nav-icon purple">
        <mat-icon>auto_awesome</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">AI Insights</div>
        <div class="nav-subtitle">Patterns & Recommendations</div>
      </div>
    </a>
    <a routerLink="/elite/ab-tests" class="nav-card">
      <div class="nav-icon green">
        <mat-icon>science</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">A/B Testing</div>
        <div class="nav-subtitle">Test Response Variations</div>
      </div>
    </a>
    <a routerLink="/elite/feedback" class="nav-card">
      <div class="nav-icon orange">
        <mat-icon>feedback</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">Feedback Analysis</div>
        <div class="nav-subtitle">Human Feedback Patterns</div>
      </div>
    </a>
    <a routerLink="/elite/tone-performance" class="nav-card">
      <div class="nav-icon blue">
        <mat-icon>record_voice_over</mat-icon>
      </div>
      <div class="nav-text">
        <div class="nav-title">Tone Performance</div>
        <div class="nav-subtitle">Best Tones by Subreddit</div>
      </div>
    </a>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading Elite Dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <ng-container *ngIf="!loading && dashboardData">
    <!-- Learning Status Banner -->
    <div *ngIf="dashboardData.learning_status" class="status-banner" [ngClass]="dashboardData.learning_status.phase">
      <mat-icon>psychology</mat-icon>
      <div class="status-content">
        <span class="status-phase">{{ dashboardData.learning_status.phase | titlecase }}</span>
        <span class="status-message">{{ dashboardData.learning_status.message }}</span>
      </div>
    </div>

    <!-- Key Metrics Row -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-label">Total Opportunities</div>
        <div class="metric-value default">{{ dashboardData.metrics.total_opportunities }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Posted</div>
        <div class="metric-value green">{{ dashboardData.metrics.posted_responses }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Tier 1/2 Rate</div>
        <div class="metric-value purple">{{ formatPercentage(dashboardData.metrics.tier_1_2_rate) }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Success Rate</div>
        <div class="metric-value blue">{{ formatPercentage(dashboardData.metrics.success_rate) }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Total Clicks</div>
        <div class="metric-value orange">{{ dashboardData.metrics.total_clicks }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Signups</div>
        <div class="metric-value teal">{{ dashboardData.metrics.total_signups || 0 }}</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Conversions</div>
        <div class="metric-value emerald">{{ dashboardData.metrics.total_conversions }}</div>
      </div>
    </div>
    <!-- Metrics Status -->
    <div *ngIf="dashboardData.metrics_status && !dashboardData.metrics_status.has_signups && !dashboardData.metrics_status.has_conversions" class="section-status info">
      <mat-icon>info_outline</mat-icon>
      <span>{{ dashboardData.metrics_status.message }}</span>
    </div>

    <!-- Two Column Layout -->
    <div class="content-grid">
      <!-- Left Column: AI Insights -->
      <div class="content-column">
        <!-- Pending AI Insights -->
        <div class="glass-card">
          <div class="card-header">
            <h2>AI Insights</h2>
            <a routerLink="/elite/insights">View All</a>
          </div>
          <div class="card-body">
            <ng-container *ngIf="dashboardData.pending_insights.length > 0; else noInsights">
              <div class="insights-list">
                <div *ngFor="let insight of dashboardData.pending_insights"
                     class="insight-item"
                     [routerLink]="['/elite/insights', insight.id]">
                  <div class="insight-icon" [ngClass]="insight.type">
                    <mat-icon>{{ getInsightIcon(insight.type) }}</mat-icon>
                  </div>
                  <div class="insight-content">
                    <div class="insight-header">
                      <span class="insight-title">{{ insight.title }}</span>
                      <span class="priority-badge" [ngClass]="insight.priority">
                        {{ insight.priority }}
                      </span>
                    </div>
                    <p class="insight-summary">{{ insight.summary }}</p>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #noInsights>
              <div class="empty-insights">
                <mat-icon>check_circle</mat-icon>
                <p *ngIf="dashboardData.insights_status; else defaultInsightsMsg">
                  {{ dashboardData.insights_status.message }}
                </p>
                <ng-template #defaultInsightsMsg>
                  <p>No pending insights. The AI will notify you when it detects important patterns.</p>
                </ng-template>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Insight Stats -->
        <div *ngIf="insightStats" class="glass-card">
          <div class="insight-stats">
            <h3>Insight Summary</h3>
            <div class="stats-row">
              <div class="stat-item">
                <div class="stat-value default">{{ insightStats.new }}</div>
                <div class="stat-label">New</div>
              </div>
              <div class="stat-item">
                <div class="stat-value orange">{{ insightStats.high_priority }}</div>
                <div class="stat-label">High Priority</div>
              </div>
              <div class="stat-item">
                <div class="stat-value blue">{{ insightStats.pending_action }}</div>
                <div class="stat-label">Need Action</div>
              </div>
              <div class="stat-item">
                <div class="stat-value gray">{{ insightStats.total }}</div>
                <div class="stat-label">Total</div>
              </div>
            </div>
            <div *ngIf="insightStats.status" class="stats-status">
              <mat-icon>auto_awesome</mat-icon>
              <span>{{ insightStats.status.message }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Intent Distribution & Performance -->
      <div class="content-column">
        <!-- Intent Tier Distribution -->
        <div class="glass-card">
          <div class="intent-section">
            <h2>Intent Distribution (30 days)</h2>
            <ng-container *ngIf="getIntentTotal() > 0; else noIntentData">
              <div class="intent-bars">
                <div *ngFor="let item of intentChartData" class="intent-bar">
                  <div class="intent-label">{{ item.label }}</div>
                  <div class="bar-container">
                    <div class="bar-fill"
                         [style.width.%]="getIntentPercentage(item.count)"
                         [style.backgroundColor]="item.color">
                    </div>
                  </div>
                  <div class="intent-count">{{ item.count }}</div>
                </div>
              </div>
              <p class="intent-note">
                Tier 1 & 2 opportunities have the highest conversion potential. Focus on increasing these.
              </p>
            </ng-container>
            <ng-template #noIntentData>
              <div class="section-status-card" *ngIf="dashboardData.intent_distribution_status">
                <mat-icon>trending_up</mat-icon>
                <p>{{ dashboardData.intent_distribution_status.message }}</p>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Top Subreddits -->
        <div class="glass-card">
          <div class="card-header">
            <h2>Top Performing Subreddits</h2>
          </div>
          <div class="card-body">
            <ng-container *ngIf="dashboardData.top_subreddits.length > 0; else noSubreddits">
              <div class="subreddits-list">
                <div *ngFor="let sub of dashboardData.top_subreddits" class="subreddit-item">
                  <div class="sub-info">
                    <div class="sub-name">r/{{ sub.name }}</div>
                    <div class="sub-responses">{{ sub.total_responses }} responses</div>
                    <div class="sub-stats">
                      <span>Conv: {{ formatPercentage(sub.conversion_rate) }}</span>
                      <span>Approval: {{ formatPercentage(sub.approval_rate) }}</span>
                    </div>
                  </div>
                  <div class="sub-value">
                    <div class="value">{{ formatCurrency(sub.expected_value) }}</div>
                    <div class="label">Expected Value</div>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #noSubreddits>
              <div class="empty-subreddits">
                <mat-icon>forum</mat-icon>
                <p *ngIf="dashboardData.subreddits_status; else defaultSubMsg">
                  {{ dashboardData.subreddits_status.message }}
                </p>
                <ng-template #defaultSubMsg>
                  <p>No subreddit performance data yet.</p>
                </ng-template>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Conversion Patterns -->
        <div class="glass-card">
          <div class="card-header">
            <h2>Learned Patterns</h2>
          </div>
          <div class="card-body">
            <ng-container *ngIf="patterns.length > 0; else noPatterns">
              <div class="patterns-list">
                <div *ngFor="let pattern of patterns.slice(0, 5)" class="pattern-item">
                  <div class="pattern-info">
                    <div class="pattern-name">{{ pattern.name }}</div>
                    <p class="pattern-desc">{{ pattern.description }}</p>
                    <div class="pattern-meta">
                      <span>{{ pattern.sample_size }} samples</span>
                      <span>{{ formatPercentage(pattern.confidence) }} confidence</span>
                    </div>
                  </div>
                  <div class="pattern-lift">
                    <div class="lift-value" [ngClass]="pattern.lift_vs_baseline >= 1.5 ? 'high' : 'normal'">
                      {{ pattern.lift_vs_baseline.toFixed(1) }}x
                    </div>
                    <div class="lift-label">lift</div>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-template #noPatterns>
              <div class="section-status-card">
                <mat-icon>psychology</mat-icon>
                <p>Pattern detection begins after posting responses. The AI will identify what works best for your product.</p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Outcomes -->
    <div class="glass-card outcomes-card">
      <div class="card-header">
        <h2>Recent Outcomes</h2>
      </div>
      <ng-container *ngIf="dashboardData.recent_outcomes.length > 0; else noOutcomes">
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Opportunity</th>
                <th>Result</th>
                <th>Clicks</th>
                <th>Sentiment</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let outcome of dashboardData.recent_outcomes">
                <td class="opportunity-cell">
                  <a [routerLink]="['/opportunities', outcome.opportunity_id]" class="opportunity-link">
                    <span class="subreddit-name">r/{{ outcome.subreddit }}</span>
                    <span class="post-title">{{ outcome.post_title | slice:0:50 }}{{ (outcome.post_title?.length || 0) > 50 ? '...' : '' }}</span>
                  </a>
                </td>
                <td>
                  <span class="result-badge" [ngClass]="outcome.success_type || 'pending'">
                    {{ outcome.success_type || 'pending' }}
                  </span>
                </td>
                <td class="clicks">{{ outcome.clicks }}</td>
                <td>
                  <span class="sentiment" [ngClass]="outcome.reply_sentiment">
                    {{ outcome.reply_sentiment }}
                  </span>
                </td>
                <td class="date">{{ outcome.created_at | date:'short' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>
      <ng-template #noOutcomes>
        <div class="section-status-card">
          <mat-icon>track_changes</mat-icon>
          <p *ngIf="dashboardData.outcomes_status; else defaultOutcomesMsg">
            {{ dashboardData.outcomes_status.message }}
          </p>
          <ng-template #defaultOutcomesMsg>
            <p>Outcomes appear here after posting responses. Engagement tracking takes 24-48 hours.</p>
          </ng-template>
        </div>
      </ng-template>
    </div>

    <!-- System Components Status -->
    <div class="glass-card components-card" *ngIf="dashboardData.components">
      <div class="card-header">
        <h2>System Components</h2>
      </div>
      <div class="components-grid">
        <div class="component-item">
          <mat-icon>psychology</mat-icon>
          <div class="component-info">
            <div class="component-name">Patterns</div>
            <div class="component-status">{{ dashboardData.components.patterns.message }}</div>
          </div>
          <div class="component-count">{{ dashboardData.components.patterns.count }}</div>
        </div>
        <div class="component-item">
          <mat-icon>science</mat-icon>
          <div class="component-info">
            <div class="component-name">A/B Tests</div>
            <div class="component-status">{{ dashboardData.components.ab_tests.message }}</div>
          </div>
          <div class="component-count">{{ dashboardData.components.ab_tests.count }}</div>
        </div>
        <div class="component-item">
          <mat-icon>forum</mat-icon>
          <div class="component-info">
            <div class="component-name">Engagement</div>
            <div class="component-status">{{ dashboardData.components.engagement.message }}</div>
          </div>
          <div class="component-count">{{ dashboardData.components.engagement.responses }} / {{ dashboardData.components.engagement.replies }}</div>
        </div>
        <div class="component-item">
          <mat-icon>person_search</mat-icon>
          <div class="component-info">
            <div class="component-name">Author Intel</div>
            <div class="component-status">{{ dashboardData.components.author_intelligence.message }}</div>
          </div>
          <div class="component-count">{{ dashboardData.components.author_intelligence.count }}</div>
        </div>
      </div>
    </div>
  </ng-container>
</div>
